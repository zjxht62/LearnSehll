# Shell退出状态
每一条Shell命令，不管是Bash内置命令（例如cd、echo），还是外部的Linux命令（例如ls、awk），还是自定义的Shell函数，当它退出（运行结束）的时候，
都会返回一个比较小的整数值给调用（使用）它的程序，这就是命令的退出状态（exit status）
> 很多 Linux 命令其实就是一个C语言程序，熟悉C语言的读者都知道，main() 函数的最后都有一个`return 0`，如果程序想在中间退出，还可以使用`exit 0`，
> 这其实就是C语言程序的退出状态。当有其它程序调用这个程序时，就可以捕获这个退出状态。

if 语句的判断条件，从本质上讲，判断的就是命令的退出状态。

**按照惯例来说，退出状态为 0 表示“成功”；也就是说，程序执行完成并且没有遇到任何问题。除 0 以外的其它任何退出状态都为“失败”。**

之所以说这是“惯例”而非“规定”，是因为也会有例外，比如 diff 命令用来比较两个文件的不同，对于“没有差别”的文件返回 0，对于“找到差别”的文件返回 1，对无效文件名返回 2。

> 有编程经验的读者请注意，Shell 的这个部分与你所熟悉的其它编程语言正好相反：在C语言、C++、Java、Python 中，0 表示“假”，其它值表示“真”。

在 Shell 中，有多种方式取得命令的退出状态，其中 $? 是最常见的一种。上节《Shell if else》中使用了 (()) 进行数学计算，我们不妨来看一下它的退出状态。请看下面的代码：
```shell
#!/bin/bash

read a
read b

(($a==$b));

echo "退出状态：$?"
```
```shell
运行结果1：
26
26
退出状态：0

运行结果2：
17
39
退出状态：1
```
再举个例子：
```shell
# 直接使用echo获得逻辑运算结果
echo $((1==1 && 0==0))  # 1
echo $((1==1 && 0==1))  # 0


# 先运算，在用$?获取命令运行结果
((1==1 && 0==0))
echo $?  # 0
((1==1 && 0==1))
echo $?  # 1

# 为什么一个是1一个是0呢？
# 因为上面的输出是逻辑运算的结果，算出来就是正确的
# 下面是获取命令的返回值，返回值的话，shell中0表示真，1表示假

# 然而if语句判断的是命令执行的返回值
```
# 退出状态和逻辑运算符的组合
Shell if 语句的一个神奇之处是允许我们使用逻辑运算符将多个退出状态组合起来，这样就可以一次判断多个条件了。

Shell 逻辑运算符

|运算符	|使用格式	|说明 |
|---|---|---|
|&&|expression1 && expression2	|逻辑与运算符，当 expression1 和 expression2 同时成立时，整个表达式才成立。如果检测到 expression1 的退出状态不为 0，就不会再检测 expression2 了，因为不管 expression2 的退出状态是什么，整个表达式必然都是不成立的，检测了也是多此一举。|
|&#124;&#124;|expression1 &#124;&#124; expression2	|逻辑或运算符，expression1 和 expression2 两个表达式中只要有一个成立，整个表达式就成立。如果检测到 expression1 的退出状态为 0，就不会再检测 expression2 了，因为不管 expression2 的退出状态是什么，整个表达式必然都是成立的，检测了也是多此一举。|
|!|!expression	|逻辑非运算符，相当于“取反”的效果。如果 expression 成立，那么整个表达式就不成立；如果 expression 不成立，那么整个表达式就成立。|

【实例】将用户输入的URL写入文件中
```shell
#!/bin/bash

read filename
read url
if test -w $filename && test -n $url; then
 echo $url > $filename
 echo "写入成功"
else
 echo "写入失败"
fi
```

在 Shell 脚本文件所在的目录新建一个文本文件并命名为 urls.txt，然后运行 Shell 脚本，运行结果为：
```shell
urls.txt↙
http://c.biancheng.net/shell/↙
写入成功
```
test 是 Shell 内置命令，可以对文件或者字符串进行检测，其中，`-w`选项用来检测文件是否存在并且可写，`-n`选项用来检测字符串是否非空。下节《Shell test》中将会详细讲解。

`>`表示重定向，默认情况下，echo 向控制台输出，这里我们将输出结果重定向到文件。

